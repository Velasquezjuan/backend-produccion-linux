const db = require('../db');
const { jsPDF } = require("jspdf");
const autoTable = require('jspdf-autotable').default;



const logoBase64 = 'data:image/png;base64,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)';

// --- Función auxiliar para calcular días entre fechas ---
function calcularDias(inicio, fin) {
    const oneDay = 24 * 60 * 60 * 1000; 
    const firstDate = new Date(inicio);
    const secondDate = new Date(fin);
    return Math.round(Math.abs((firstDate - secondDate) / oneDay)) + 1; 
}

function getFechaInicioDefault() {
    const d = new Date();
    d.setDate(d.getDate() - 30); // Resta de dias a usar se inicia con 0 para marcar 1 dia
    return d.toISOString().split('T')[0];
}

function calcularDiferenciaDias(fechaReferencia) {
    if (!fechaReferencia) return 0;
    const oneDay = 24 * 60 * 60 * 1000; 
    const hoy = new Date();
    const fechaRef = new Date(fechaReferencia);
    hoy.setHours(0,0,0,0);
    fechaRef.setHours(0,0,0,0);
    
    return Math.round(Math.abs((hoy - fechaRef) / oneDay)); 
}

// Función auxiliar para rango del reporte (header)
function calcularDiasRango(inicio, fin) {
    const oneDay = 24 * 60 * 60 * 1000; 
    return Math.round(Math.abs((new Date(inicio) - new Date(fin)) / oneDay)) + 1;
}

// --- Función para obtener datos para el dashboard (gráficos iniciales) ---
/*exports.getDashboardData = async (req, res) => {
  try {
    // 1. Centros (Destinos) que más se repiten
    const [centrosMasUsan] = await db.query(`
      SELECT destino, COUNT(*) AS total_viajes FROM (
        SELECT punto_destino AS destino FROM VIAJE
        UNION ALL
        SELECT punto_destino AS destino FROM VIAJE_MASIVO
      ) AS destinos_unificados
      GROUP BY destino ORDER BY total_viajes DESC LIMIT 5;
    `);

    // 2. Vehículos más utilizados
    const [vehiculosMasUsados] = await db.query(`
      SELECT v.marca, v.modelo, v.patente, COUNT(*) AS total_viajes FROM (
        SELECT vehiculo_patente FROM VIAJE WHERE vehiculo_patente IS NOT NULL
        UNION ALL
        SELECT vehiculo_patente FROM VIAJE_MASIVO WHERE vehiculo_patente IS NOT NULL
      ) AS patentes
      JOIN VEHICULO v ON patentes.vehiculo_patente = v.patente
      GROUP BY v.patente, v.marca, v.modelo ORDER BY total_viajes DESC LIMIT 5;
    `);

    // 3. Programa con mayor uso de vehículos
    const [programaMayorUso] = await db.query(`
      SELECT p.nombre_programa, COUNT(*) AS total_viajes FROM (
        SELECT PROGRAMA_id_programa AS id_programa FROM VIAJE
        UNION ALL
        SELECT PROGRAMA_id_programa AS id_programa FROM VIAJE_MASIVO
      ) AS programas
      JOIN PROGRAMA p ON programas.id_programa = p.id_programa
      GROUP BY p.nombre_programa ORDER BY total_viajes DESC LIMIT 5;
    `);

    // 4. Usuario que más solicitudes realiza
    const [usuarioMasSolicitudes] = await db.query(`
      SELECT u.nombre, u.apellido_paterno, COUNT(*) AS total_solicitudes FROM (
        SELECT solicitante_rut_usuario AS rut FROM VIAJE
        UNION ALL
        SELECT solicitante_rut_usuario AS rut FROM VIAJE_MASIVO
      ) AS solicitantes
      JOIN USUARIO u ON solicitantes.rut = u.rut_usuario
      GROUP BY u.nombre, u.apellido_paterno ORDER BY total_solicitudes DESC LIMIT 5;
    `);

    res.status(200).json({
      centrosMasUsan,
      vehiculosMasUsados,
      programaMayorUso,
      usuarioMasSolicitudes
    });

  } catch (error) {
    console.error('Error al obtener datos del dashboard:', error);
    res.status(500).json({ message: 'Error interno del servidor.' });
  }
};*/
exports.getDashboardData = async (req, res) => {
  try {
    const [centrosMasUsan] = await db.query(`
      SELECT destino, COUNT(*) AS total_viajes FROM (
        SELECT punto_destino AS destino FROM viaje
        UNION ALL
        SELECT punto_destino AS destino FROM viaje_masivo
      ) AS destinos_unificados
      GROUP BY destino ORDER BY total_viajes DESC LIMIT 5;
    `);

    const [vehiculosMasUsados] = await db.query(`
      SELECT v.marca, v.modelo, v.patente, COUNT(*) AS total_viajes FROM (
        SELECT vehiculo_patente FROM viaje WHERE vehiculo_patente IS NOT NULL
        UNION ALL
        SELECT vehiculo_patente FROM viaje_masivo WHERE vehiculo_patente IS NOT NULL
      ) AS patentes
      JOIN vehiculo v ON patentes.vehiculo_patente = v.patente
      GROUP BY v.patente, v.marca, v.modelo ORDER BY total_viajes DESC LIMIT 5;
    `);

    const [programaMayorUso] = await db.query(`
      SELECT p.nombre_programa, COUNT(*) AS total_viajes FROM (
        SELECT programa_id_programa AS id_programa FROM viaje
        UNION ALL
        SELECT programa_id_programa AS id_programa FROM viaje_masivo
      ) AS programas
      JOIN programa p ON programas.id_programa = p.id_programa
      GROUP BY p.nombre_programa ORDER BY total_viajes DESC LIMIT 5;
    `);

    const [usuarioMasSolicitudes] = await db.query(`
      SELECT u.nombre, u.apellido_paterno, COUNT(*) AS total_solicitudes FROM (
        SELECT solicitante_rut_usuario AS rut FROM viaje
        UNION ALL
        SELECT solicitante_rut_usuario AS rut FROM viaje_masivo
      ) AS solicitantes
      JOIN usuario u ON solicitantes.rut = u.rut_usuario
      GROUP BY u.nombre, u.apellido_paterno ORDER BY total_solicitudes DESC LIMIT 5;
    `);

    res.status(200).json({
      centrosMasUsan,
      vehiculosMasUsados,
      programaMayorUso,
      usuarioMasSolicitudes
    });

  } catch (error) {
    console.error('Error al obtener datos del dashboard:', error);
    res.status(500).json({ message: 'Error interno del servidor.' });
  }
};

// --- Función para exportar reportes en PDF ---
/* exports.exportarReporte = async (req, res) => {
  try {
    const { patente, centro, proveedor, programa, 
      fechaInicio, fechaFin, estado, Movimiento } = req.query;

    let fechaDesde = fechaInicio || getFechaInicioDefault(); 
    let fechaHasta = fechaFin || new Date().toISOString().split('T')[0];
    const diasInactivos = calcularDias(fechaDesde, fechaHasta);

    let reporteResultados = [];
    let vehiculosSinMovimiento = [];

    // --- LÓGICA DE OBTENCIÓN DE DATOS ---
    
    if (Movimiento !== 'SinMovmiento') {
         let baseQuery = `
          (SELECT v.id_viaje, v.fecha_viaje, v.hora_inicio, v.punto_destino, v.estado, v.vehiculo_patente,
            u.nombre as nombre_solicitante, p.nombre_programa, veh.nombre_conductor, co.nombre_proveedor,
            veh.necesita_reemplazo, veh.patente_reemplazo,
            'Diario' as tipo_origen
          FROM VIAJE v
          LEFT JOIN USUARIO u ON v.solicitante_rut_usuario = u.rut_usuario
          LEFT JOIN PROGRAMA p ON v.PROGRAMA_id_programa = p.id_programa
          LEFT JOIN VEHICULO veh ON v.vehiculo_patente = veh.patente
          LEFT JOIN CONTRATO co ON veh.patente = co.VEHICULO_patente)
          UNION ALL
          (SELECT vm.id_viaje, vm.fecha_viaje, vm.hora_inicio, vm.punto_destino, vm.estado, vm.vehiculo_patente,
            u.nombre as nombre_solicitante, p.nombre_programa, veh.nombre_conductor, co.nombre_proveedor,
            veh.necesita_reemplazo, veh.patente_reemplazo,
            'Masivo' as tipo_origen
          FROM VIAJE_MASIVO vm
          LEFT JOIN USUARIO u ON vm.solicitante_rut_usuario = u.rut_usuario
          LEFT JOIN PROGRAMA p ON vm.PROGRAMA_id_programa = p.id_programa
          LEFT JOIN VEHICULO veh ON vm.vehiculo_patente = veh.patente
          LEFT JOIN CONTRATO co ON veh.patente = co.VEHICULO_patente)
        `;
        
        let query = `SELECT * FROM (${baseQuery}) AS viajes_unificados WHERE 1=1`;
        const params = [];

       
        query += ` AND (estado = 'finalizado' OR estado = 'no realizado')`;

        if (patente) { query += ` AND vehiculo_patente LIKE ?`; params.push(`%${patente}%`); }
        if (centro) { query += ` AND punto_destino LIKE ?`; params.push(`%${centro}%`); }
        if (proveedor) { query += ` AND nombre_proveedor LIKE ?`; params.push(`%${proveedor}%`); }
        if (programa) { query += ` AND nombre_programa LIKE ?`; params.push(`%${programa}%`); }
        query += ` AND fecha_viaje >= ?`; params.push(fechaDesde);
        query += ` AND fecha_viaje <= ?`; params.push(fechaHasta);
        if (estado) { query += ` AND estado = ?`; params.push(estado); }

        query += ` ORDER BY fecha_viaje DESC, hora_inicio DESC`; // Ordenar para mezclar diarios y masivos

        const [rows] = await db.query(query, params);
        reporteResultados = rows;
    }
    if (Movimiento === 'SinMovmiento' || (!Movimiento && !patente)) {
        
        const queryOciosos = `
            SELECT 
                v.patente, v.marca, v.modelo, v.nombre_conductor, 
                c.nombre_proveedor, 
                p.nombre_programa
            FROM VEHICULO v
            LEFT JOIN CONTRATO c ON v.patente = c.VEHICULO_patente
            LEFT JOIN VEHICULO_has_PROGRAMA vhp ON v.patente = vhp.VEHICULO_patente
            LEFT JOIN PROGRAMA p ON vhp.PROGRAMA_id_programa = p.id_programa
            WHERE v.activo = 'si' 
            AND v.patente NOT IN (
                SELECT vehiculo_patente FROM VIAJE 
                WHERE fecha_viaje BETWEEN ? AND ? AND vehiculo_patente IS NOT NULL
                UNION
                SELECT vehiculo_patente FROM VIAJE_MASIVO 
                WHERE fecha_viaje BETWEEN ? AND ? AND vehiculo_patente IS NOT NULL
            )
        `;
        const [rowsOc] = await db.query(queryOciosos, [fechaDesde, fechaHasta, fechaDesde, fechaHasta]);
        vehiculosSinMovimiento = rowsOc;

        if (proveedor) {
             vehiculosSinMovimiento = vehiculosSinMovimiento.filter(r => r.nombre_proveedor && r.nombre_proveedor.toLowerCase().includes(proveedor.toLowerCase()));
        }
        if (programa) {
             vehiculosSinMovimiento = vehiculosSinMovimiento.filter(r => r.nombre_programa && r.nombre_programa.toLowerCase().includes(programa.toLowerCase()));
        }
        if (patente) {
             vehiculosSinMovimiento = vehiculosSinMovimiento.filter(r => r.patente && r.patente.toLowerCase().includes(patente.toLowerCase()));
        }
    }
     

       if (reporteResultados.length === 0 && vehiculosSinMovimiento.length === 0) {
        return res.status(404).json({ message: "No se encontraron datos para generar el reporte en el periodo seleccionado." });
    }

    // --- GENERACIÓN DEL PDF ---
    const doc = new jsPDF();
    const imagen64 = logoBase64.split(',')[1];
    const imageBuffer = Buffer.from(imagen64, 'base64');

    doc.text("Reporte de Bitácora", 14, 15);
    doc.addImage(imageBuffer, 'PNG', 150, 10, 40, 15);
    
    let finalY = 30; 

    // Resumen
    doc.setFontSize(10);
    if(fechaInicio || fechaFin) {
        doc.text(`Periodo: ${fechaInicio || 'Inicio'} al ${fechaFin || 'Hoy'} (${diasInactivos} días)`, 14, finalY);
        finalY += 10;
    }

    // --- TABLA AZUL: VIAJES  ---
    if (Movimiento !== 'SinMovmiento' && reporteResultados.length > 0) {
        const head = [['Fecha', 'Origen', 'Solicitante', 'Destino', 'Patente', 'Conductor', 'Estado', 'Obs.']];
        const body = reporteResultados.map(v => {
          const observacion = v.necesita_reemplazo === 'si' ? `Reemplazo: ${v.patente_reemplazo}` : ''; 
          return [
            new Date(v.fecha_viaje).toLocaleDateString('es-CL'),
            v.tipo_origen, 
            v.nombre_solicitante,
            v.punto_destino,
            v.vehiculo_patente || 'N/A',
            v.nombre_conductor || 'N/A',
            v.estado, 
            observacion
          ];
        });

        autoTable(doc, {
          head: head,
          body: body,
          startY: finalY,
          styles: { fontSize: 8 }, 
          headStyles: { fillColor: [30, 86, 160] }
        });
        
        finalY = (doc).lastAutoTable.finalY + 10;
    } else if (Movimiento === 'ConMovimiento' && reporteResultados.length === 0) {
        doc.text("No se encontraron viajes realizados en este periodo.", 14, finalY);
        finalY += 10;
    }

    // --- TABLA ROJA: SIN MOVIMIENTO ---
    if ((Movimiento === 'SinMovmiento' || !Movimiento) && vehiculosSinMovimiento.length > 0) {
        
        if (!patente || Movimiento === 'SinMovmiento') {
            if (finalY > 250) { doc.addPage(); finalY = 20; }

            doc.setFontSize(12);
            doc.setTextColor(200, 0, 0); 
            doc.text(`Vehículos Sin Movimiento (${diasInactivos} días inactivos)`, 14, finalY);
            doc.setTextColor(0, 0, 0); 

            const headOciosos = [['Patente', 'Marca / Modelo','Programa', 'Conductor', 'Proveedor', 'Días Inactivo']];
            const bodyOciosos = vehiculosSinMovimiento.map(v => [
                v.patente,
                `${v.marca} ${v.modelo}`,
                v.nombre_programa || 'Sin Asignar',
                v.nombre_conductor || 'Sin Conductor',
                v.nombre_proveedor || 'N/A',
                diasInactivos + ' días' 
            ]);

            autoTable(doc, {
                head: headOciosos,
                body: bodyOciosos,
                startY: finalY + 5,
                styles: { fontSize: 8 },
                headStyles: { fillColor: [200, 50, 50] } 
            });
        }
    }
  
    res.send(Buffer.from(doc.output('arraybuffer')));

  } catch (error) {
    console.error('Error al exportar el reporte:', error);
    res.status(500).json({ message: 'Error interno del servidor.' });
  }
};*/
exports.exportarReporte = async (req, res) => {
  try {
    const { patente, centro, proveedor, programa, 
      fechaInicio, fechaFin, estado, Movimiento } = req.query;

    let fechaDesde = fechaInicio || getFechaInicioDefault(); 
    let fechaHasta = fechaFin || new Date().toISOString().split('T')[0];
    const diasInactivos = calcularDias(fechaDesde, fechaHasta);

    let reporteResultados = [];
    let vehiculosSinMovimiento = [];

    // --- LÓGICA CON MOVIMIENTO ---
    if (Movimiento !== 'SinMovmiento') {
         let baseQuery = `
          (SELECT v.id_viaje, v.fecha_viaje, v.hora_inicio, v.punto_destino, v.estado, v.vehiculo_patente,
            u.nombre as nombre_solicitante, p.nombre_programa, veh.nombre_conductor, co.nombre_proveedor,
            veh.necesita_reemplazo, veh.patente_reemplazo, 'Diario' as tipo_origen
          FROM viaje v
          LEFT JOIN usuario u ON v.solicitante_rut_usuario = u.rut_usuario
          LEFT JOIN programa p ON v.programa_id_programa = p.id_programa
          LEFT JOIN vehiculo veh ON v.vehiculo_patente = veh.patente
          LEFT JOIN contrato co ON veh.patente = co.vehiculo_patente)
          UNION ALL
          (SELECT vm.id_viaje, vm.fecha_viaje, vm.hora_inicio, vm.punto_destino, vm.estado, vm.vehiculo_patente,
            u.nombre as nombre_solicitante, p.nombre_programa, veh.nombre_conductor, co.nombre_proveedor,
            veh.necesita_reemplazo, veh.patente_reemplazo, 'Masivo' as tipo_origen
          FROM viaje_masivo vm
          LEFT JOIN usuario u ON vm.solicitante_rut_usuario = u.rut_usuario
          LEFT JOIN programa p ON vm.programa_id_programa = p.id_programa
          LEFT JOIN vehiculo veh ON vm.vehiculo_patente = veh.patente
          LEFT JOIN contrato co ON veh.patente = co.vehiculo_patente)
        `;
        
        let query = `SELECT * FROM (${baseQuery}) AS viajes_unificados WHERE 1=1`;
        const params = [];

        // query += ` AND (estado = 'finalizado' OR estado = 'no realizado')`;

        if (patente) { query += ` AND vehiculo_patente LIKE ?`; params.push(`%${patente}%`); }
        if (centro) { query += ` AND punto_destino LIKE ?`; params.push(`%${centro}%`); }
        if (proveedor) { query += ` AND nombre_proveedor LIKE ?`; params.push(`%${proveedor}%`); }
        if (programa) { query += ` AND nombre_programa LIKE ?`; params.push(`%${programa}%`); }
        
        query += ` AND fecha_viaje >= ?`; params.push(fechaDesde);
        query += ` AND fecha_viaje <= ?`; params.push(fechaHasta);

        if (estado) { query += ` AND estado = ?`; params.push(estado); }

        query += ` ORDER BY fecha_viaje DESC, hora_inicio DESC`;

        const [rows] = await db.query(query, params);
        reporteResultados = rows;
    }

    // --- LÓGICA SIN MOVIMIENTO ---
    if (Movimiento === 'SinMovmiento' || (!Movimiento && !patente)) {
        const queryOciosos = `
            SELECT 
                v.patente, v.marca, v.modelo, v.nombre_conductor, 
                c.nombre_proveedor, p.nombre_programa,
                c.fecha_inicio as fecha_contrato,
                last_trips.ultimo_viaje_real
            FROM vehiculo v
            LEFT JOIN contrato c ON v.patente = c.vehiculo_patente
            LEFT JOIN vehiculo_has_programa vhp ON v.patente = vhp.vehiculo_patente
            LEFT JOIN programa p ON vhp.programa_id_programa = p.id_programa
            LEFT JOIN (
                SELECT vehiculo_patente, MAX(fecha_viaje) as ultimo_viaje_real
                FROM (
                    SELECT vehiculo_patente, fecha_viaje FROM viaje
                    UNION ALL
                    SELECT vehiculo_patente, fecha_viaje FROM viaje_masivo
                ) t_union
                GROUP BY vehiculo_patente
            ) last_trips ON v.patente = last_trips.vehiculo_patente
            WHERE v.activo = 'si' 
            AND v.patente NOT IN (
                SELECT vehiculo_patente FROM viaje 
                WHERE fecha_viaje BETWEEN ? AND ? AND vehiculo_patente IS NOT NULL
                UNION
                SELECT vehiculo_patente FROM viaje_masivo 
                WHERE fecha_viaje BETWEEN ? AND ? AND vehiculo_patente IS NOT NULL
            )
        `;
        const [rowsOc] = await db.query(queryOciosos, [fechaDesde, fechaHasta, fechaDesde, fechaHasta]);
        vehiculosSinMovimiento = rowsOc.map(v => {
             const fechaReferencia = v.ultimo_viaje_real || v.fecha_contrato || fechaDesde;
             const diasReales = calcularDiferenciaDias(fechaReferencia);
             
             return { ...v, diasInactivosReal: diasReales };
        });

        if (proveedor) {
             vehiculosSinMovimiento = vehiculosSinMovimiento.filter(r => r.nombre_proveedor && r.nombre_proveedor.toLowerCase().includes(proveedor.toLowerCase()));
        }
        if (programa) {
             vehiculosSinMovimiento = vehiculosSinMovimiento.filter(r => r.nombre_programa && r.nombre_programa.toLowerCase().includes(programa.toLowerCase()));
        }
        if (patente) {
             vehiculosSinMovimiento = vehiculosSinMovimiento.filter(r => r.patente && r.patente.toLowerCase().includes(patente.toLowerCase()));
        }
    }
     
    if (reporteResultados.length === 0 && vehiculosSinMovimiento.length === 0) {
        return res.status(404).json({ message: "No se encontraron datos para generar el reporte en el periodo seleccionado." });
    }

    // --- GENERACIÓN DEL PDF ---
   const doc = new jsPDF();
    const imagen64 = logoBase64.split(',')[1];
    const imageBuffer = Buffer.from(imagen64, 'base64');

    doc.text("Reporte de Bitácora", 14, 15);
    doc.addImage(imageBuffer, 'PNG', 150, 10, 40, 15);
    
    let finalY = 30; 

    // Resumen
    doc.setFontSize(10);
    if(fechaInicio || fechaFin) {
        doc.text(`Periodo: ${fechaInicio || 'Inicio'} al ${fechaFin || 'Hoy'} (${diasInactivos} días)`, 14, finalY);
        finalY += 10;
    }
    // TABLA AZUL
    if (Movimiento !== 'SinMovmiento' && reporteResultados.length > 0) {
        const head = [['Fecha', 'Origen', 'Solicitante', 'Destino', 'Patente', 'Conductor', 'Estado', 'Obs.']];
        const body = reporteResultados.map(v => {
          const observacion = v.necesita_reemplazo === 'si' ? `Reemplazo: ${v.patente_reemplazo}` : ''; 
          return [
            new Date(v.fecha_viaje).toLocaleDateString('es-CL'),
            v.tipo_origen, 
            v.nombre_solicitante,
            v.punto_destino,
            v.vehiculo_patente || 'N/A',
            v.nombre_conductor || 'N/A',
            v.estado, 
            observacion
          ];
        });

        autoTable(doc, {
          head: head,
          body: body,
          startY: finalY,
          styles: { fontSize: 8 }, 
          headStyles: { fillColor: [30, 86, 160] }
        });
        
        finalY = (doc).lastAutoTable.finalY + 10;
    } else if (Movimiento === 'ConMovimiento' && reporteResultados.length === 0) {
        doc.text("No se encontraron viajes realizados en este periodo.", 14, finalY);
        finalY += 10;
    }

    // TABLA ROJA
    if ((Movimiento === 'SinMovmiento' || !Movimiento) && vehiculosSinMovimiento.length > 0) {
        
        if (!patente || Movimiento === 'SinMovmiento') {
            if (finalY > 250) { doc.addPage(); finalY = 20; }

            doc.setFontSize(12);
            doc.setTextColor(200, 0, 0); 
            doc.text(`Vehículos Sin Movimiento`, 14, finalY);
            doc.setTextColor(0, 0, 0); 

            const headOciosos = [['Patente', 'Marca / Modelo','Programa', 'Conductor', 'Proveedor', 'Días Inactivo']];
            const bodyOciosos = vehiculosSinMovimiento.map(v => [
                v.patente,
                `${v.marca} ${v.modelo}`,
                v.nombre_programa || 'Sin Asignar',
                v.nombre_conductor || 'Sin Conductor',
                v.nombre_proveedor || 'N/A',
                v.diasInactivosReal + ' días' 
            ]);

            autoTable(doc, {
                head: headOciosos,
                body: bodyOciosos,
                startY: finalY + 5,
                styles: { fontSize: 8 },
                headStyles: { fillColor: [200, 50, 50] } 
            });
        }
    }
  
    res.send(Buffer.from(doc.output('arraybuffer')));

  } catch (error) {
    console.error('Error al exportar el reporte:', error);
    res.status(500).json({ message: 'Error interno del servidor.' });
  }
};


// --- Función para generar reportes con filtros ---
/*exports.generarReporte = async (req, res) => {
  try {
    const { patente, centro, proveedor, programa, fechaInicio, fechaFin } = req.query;

    let baseQuery = `
      (SELECT 
        v.id_viaje,
         v.fecha_viaje, 
         v.hora_inicio,
         v.punto_destino,
         v.estado, v.vehiculo_patente,
        u.nombre as nombre_solicitante, p.nombre_programa, veh.nombre_conductor, co.nombre_proveedor
      FROM VIAJE v
      LEFT JOIN USUARIO u ON v.solicitante_rut_usuario = u.rut_usuario
      LEFT JOIN PROGRAMA p ON v.PROGRAMA_id_programa = p.id_programa
      LEFT JOIN VEHICULO veh ON v.vehiculo_patente = veh.patente
      LEFT JOIN CONTRATO co ON veh.patente = co.VEHICULO_patente)
      UNION ALL
      (SELECT 
        vm.id_viaje, vm.fecha_viaje, vm.hora_inicio, vm.punto_destino, vm.estado, vm.vehiculo_patente,
        u.nombre as nombre_solicitante, p.nombre_programa, veh.nombre_conductor, co.nombre_proveedor
      FROM VIAJE_MASIVO vm
      LEFT JOIN USUARIO u ON vm.solicitante_rut_usuario = u.rut_usuario
      LEFT JOIN PROGRAMA p ON vm.PROGRAMA_id_programa = p.id_programa
      LEFT JOIN VEHICULO veh ON vm.vehiculo_patente = veh.patente
      LEFT JOIN CONTRATO co ON veh.patente = co.VEHICULO_patente)
    `;

    let query = `SELECT * FROM (${baseQuery}) AS viajes_unificados WHERE 1=1`;
    const params = [];

    if (patente) { query += ` AND vehiculo_patente LIKE ?`; params.push(`%${patente}%`); }
    if (centro) { query += ` AND punto_destino LIKE ?`; params.push(`%${centro}%`); }
    if (proveedor) { query += ` AND nombre_proveedor LIKE ?`; params.push(`%${proveedor}%`); }
    if (programa) { query += ` AND nombre_programa LIKE ?`; params.push(`%${programa}%`); }
    if (fechaInicio) { query += ` AND fecha_viaje >= ?`; params.push(fechaInicio); }
    if (fechaFin) { query += ` AND fecha_viaje <= ?`; params.push(fechaFin); }

    const [reporteResultados] = await db.query(query, params);

    let vehiculosPorProveedor = 0;

    if (proveedor) {
      const [res] = await db.query(`SELECT COUNT(*) as total FROM CONTRATO WHERE nombre_proveedor LIKE ?`, [`%${proveedor}%`]);
      vehiculosPorProveedor = res[0].total;
    }
     if (patente) {
             resultados = resultados.filter(r => r.vehiculo_patente.toLowerCase().includes(patente.toLowerCase()));
        }
        if (programa) {
             resultados = resultados.filter(r => r.nombre_programa && r.nombre_programa.toLowerCase().includes(programa.toLowerCase()));
        }

    res.status(200).json({
      resultados: reporteResultados,
      resumen: {
        totalViajesRealizados: reporteResultados.length,
        totalCentrosVisitados: new Set(reporteResultados.map(r => r.punto_destino)).size,
        vehiculosPorProveedor: vehiculosPorProveedor,
      }
    });

  } catch (error) {
    console.error('Error al generar reporte:', error);
    res.status(500).json({ message: 'Error interno del servidor.' });
  }
};*/

/*exports.generarReporte = async (req, res) => {
  try {
    const { patente, centro, proveedor, programa, fechaInicio, fechaFin, Movimiento } = req.query;

    let fechaDesde = fechaInicio || getFechaInicioDefault();
    let fechaHasta = fechaFin || new Date().toISOString().split('T')[0];
    const diasInactivos = calcularDias(fechaDesde, fechaHasta);

    let resultados = [];
    
    if (Movimiento === 'SinMovmiento') {
        const queryOciosos = `
            SELECT 
                v.patente as vehiculo_patente, 
                v.marca, 
                v.modelo, 
                v.nombre_conductor, 
                c.nombre_proveedor,
                p.nombre_programa,
                'Sin Movimiento' as estado_reporte
            FROM VEHICULO v
            LEFT JOIN CONTRATO c ON v.patente = c.VEHICULO_patente
            LEFT JOIN VEHICULO_has_PROGRAMA vhp ON v.patente = vhp.VEHICULO_patente
            LEFT JOIN PROGRAMA p ON vhp.PROGRAMA_id_programa = p.id_programa
            WHERE v.activo = 'si' 
            AND v.patente NOT IN (
                SELECT vehiculo_patente FROM VIAJE 
                WHERE fecha_viaje BETWEEN ? AND ? AND vehiculo_patente IS NOT NULL
                UNION
                SELECT vehiculo_patente FROM VIAJE_MASIVO 
                WHERE fecha_viaje BETWEEN ? AND ? AND vehiculo_patente IS NOT NULL
            )
        `;
        
        const paramsOciosos = [fechaDesde, fechaHasta, fechaDesde, fechaHasta];
        const [rows] = await db.query(queryOciosos, paramsOciosos);
        
        resultados = rows;
        if (proveedor) {
            resultados = resultados.filter(r => r.nombre_proveedor && r.nombre_proveedor.toLowerCase().includes(proveedor.toLowerCase()));
        }
        if (patente) {
             resultados = resultados.filter(r => r.vehiculo_patente.toLowerCase().includes(patente.toLowerCase()));
        }
        
        if (programa) {
             resultados = resultados.filter(r => r.nombre_programa && r.nombre_programa.toLowerCase().includes(programa.toLowerCase()));
        }

    } else {
        let baseQuery = `
          (SELECT 
            v.id_viaje, v.fecha_viaje, v.hora_inicio, v.punto_destino, v.estado, v.vehiculo_patente,
            u.nombre as nombre_solicitante, p.nombre_programa, veh.nombre_conductor, co.nombre_proveedor,
            'Diario' as tipo_origen
          FROM VIAJE v
          LEFT JOIN USUARIO u ON v.solicitante_rut_usuario = u.rut_usuario
          LEFT JOIN PROGRAMA p ON v.PROGRAMA_id_programa = p.id_programa
          LEFT JOIN VEHICULO veh ON v.vehiculo_patente = veh.patente
          LEFT JOIN CONTRATO co ON veh.patente = co.VEHICULO_patente)
          UNION ALL
          (SELECT 
            vm.id_viaje, vm.fecha_viaje, vm.hora_inicio, vm.punto_destino, vm.estado, vm.vehiculo_patente,
            u.nombre as nombre_solicitante, p.nombre_programa, veh.nombre_conductor, co.nombre_proveedor,
            'Masivo' as tipo_origen
          FROM VIAJE_MASIVO vm
          LEFT JOIN USUARIO u ON vm.solicitante_rut_usuario = u.rut_usuario
          LEFT JOIN PROGRAMA p ON vm.PROGRAMA_id_programa = p.id_programa
          LEFT JOIN VEHICULO veh ON vm.vehiculo_patente = veh.patente
          LEFT JOIN CONTRATO co ON veh.patente = co.VEHICULO_patente)
        `;

        let query = `SELECT * FROM (${baseQuery}) AS viajes_unificados WHERE 1=1`;
        const params = [];

        if (Movimiento === 'ConMovimiento') {
             query += ` AND estado = 'finalizado'`;
        } else {
             query += ` AND (estado = 'finalizado' OR estado = 'no realizado')`;
        }

        if (patente) { query += ` AND vehiculo_patente LIKE ?`; params.push(`%${patente}%`); }
        if (centro) { query += ` AND punto_destino LIKE ?`; params.push(`%${centro}%`); }
        if (proveedor) { query += ` AND nombre_proveedor LIKE ?`; params.push(`%${proveedor}%`); }
        if (programa) { query += ` AND nombre_programa LIKE ?`; params.push(`%${programa}%`); }
        query += ` AND fecha_viaje >= ?`; params.push(fechaDesde);
        query += ` AND fecha_viaje <= ?`; params.push(fechaHasta);

        query += ` ORDER BY fecha_viaje DESC, hora_inicio DESC`;

        const [rows] = await db.query(query, params);
        resultados = rows;
    }

    let vehiculosPorProveedor = 0;
    if (proveedor) {
      const [res] = await db.query(`SELECT COUNT(*) as total FROM CONTRATO WHERE nombre_proveedor LIKE ?`, [`%${proveedor}%`]);
      vehiculosPorProveedor = res[0].total;
    }
    

    res.status(200).json({
      resultados: resultados,
      esSinMovimiento: Movimiento === 'SinMovmiento',
      diasInactivos: diasInactivos,
      resumen: {
        totalRegistros: resultados.length,
        totalCentrosVisitados: Movimiento === 'SinMovmiento' ? 0 : new Set(resultados.map(r => r.punto_destino)).size,
        vehiculosPorProveedor: vehiculosPorProveedor,
      }
    });

  } catch (error) {
    console.error('Error al generar reporte:', error);
    res.status(500).json({ message: 'Error interno del servidor.' });
  }
};*/
exports.generarReporte = async (req, res) => {
  try {
    const { patente, centro, proveedor, programa, fechaInicio, fechaFin, Movimiento } = req.query;

    let fechaDesde = fechaInicio || getFechaInicioDefault();
    let fechaHasta = fechaFin || new Date().toISOString().split('T')[0];
    const diasRangoReporte = calcularDiasRango(fechaDesde, fechaHasta);

    let resultados = [];
    
    if (Movimiento === 'SinMovmiento') {
        const queryOciosos = `
            SELECT 
                v.patente as vehiculo_patente, 
                v.marca, 
                v.modelo, 
                v.nombre_conductor, 
                c.nombre_proveedor,
                p.nombre_programa,
                'Sin Movimiento' as estado_reporte,
                c.fecha_inicio as fecha_contrato,       
                last_trips.ultimo_viaje_real            
            FROM vehiculo v
            LEFT JOIN contrato c ON v.patente = c.vehiculo_patente
            LEFT JOIN vehiculo_has_programa vhp ON v.patente = vhp.vehiculo_patente
            LEFT JOIN programa p ON vhp.programa_id_programa = p.id_programa
            LEFT JOIN (
                SELECT vehiculo_patente, MAX(fecha_viaje) as ultimo_viaje_real
                FROM (
                    SELECT vehiculo_patente, fecha_viaje FROM viaje
                    UNION ALL
                    SELECT vehiculo_patente, fecha_viaje FROM viaje_masivo
                ) t_union
                GROUP BY vehiculo_patente
            ) last_trips ON v.patente = last_trips.vehiculo_patente
            WHERE v.activo = 'si' 
            AND v.patente NOT IN (
                SELECT vehiculo_patente FROM viaje 
                WHERE fecha_viaje BETWEEN ? AND ? AND vehiculo_patente IS NOT NULL
                UNION
                SELECT vehiculo_patente FROM viaje_masivo 
                WHERE fecha_viaje BETWEEN ? AND ? AND vehiculo_patente IS NOT NULL
            )
        `;
        
        const paramsOciosos = [fechaDesde, fechaHasta, fechaDesde, fechaHasta];
        const [rows] = await db.query(queryOciosos, paramsOciosos);
        
      resultados = rows.map(v => {
     let diasReales = 0;
     
     if (v.ultimo_viaje_real) {
         diasReales = calcularDiferenciaDias(v.ultimo_viaje_real);
     } 
     else if (v.fecha_contrato) {
         diasReales = calcularDiferenciaDias(v.fecha_contrato);
     } 
     else {
         diasReales = 0;
         console.log(`Aviso: El vehículo ${v.vehiculo_patente} no tiene viajes ni fecha de contrato.`);
     }
             return { ...v, diasInactivosReal: diasReales };
        });

        if (proveedor) {
            resultados = resultados.filter(r => r.nombre_proveedor && r.nombre_proveedor.toLowerCase().includes(proveedor.toLowerCase()));
        }
        if (patente) {
             resultados = resultados.filter(r => r.vehiculo_patente.toLowerCase().includes(patente.toLowerCase()));
        }
        if (programa) {
             resultados = resultados.filter(r => r.nombre_programa && r.nombre_programa.toLowerCase().includes(programa.toLowerCase()));
        }

    } else {
        let baseQuery = `
          (SELECT 
            v.id_viaje, v.fecha_viaje, v.hora_inicio, v.punto_destino, v.estado, v.vehiculo_patente,
            u.nombre as nombre_solicitante, p.nombre_programa, veh.nombre_conductor, co.nombre_proveedor,
            'Diario' as tipo_origen
          FROM viaje v
          LEFT JOIN usuario u ON v.solicitante_rut_usuario = u.rut_usuario
          LEFT JOIN programa p ON v.programa_id_programa = p.id_programa
          LEFT JOIN vehiculo veh ON v.vehiculo_patente = veh.patente
          LEFT JOIN contrato co ON veh.patente = co.vehiculo_patente)
          UNION ALL
          (SELECT 
            vm.id_viaje, vm.fecha_viaje, vm.hora_inicio, vm.punto_destino, vm.estado, vm.vehiculo_patente,
            u.nombre as nombre_solicitante, p.nombre_programa, veh.nombre_conductor, co.nombre_proveedor,
            'Masivo' as tipo_origen
          FROM viaje_masivo vm
          LEFT JOIN usuario u ON vm.solicitante_rut_usuario = u.rut_usuario
          LEFT JOIN programa p ON vm.programa_id_programa = p.id_programa
          LEFT JOIN vehiculo veh ON vm.vehiculo_patente = veh.patente
          LEFT JOIN contrato co ON veh.patente = co.vehiculo_patente)
        `;

        let query = `SELECT * FROM (${baseQuery}) AS viajes_unificados WHERE 1=1`;
        const params = [];

        // query += ` AND (estado = 'finalizado' OR estado = 'no realizado')`;

        if (patente) { query += ` AND vehiculo_patente LIKE ?`; params.push(`%${patente}%`); }
        if (centro) { query += ` AND punto_destino LIKE ?`; params.push(`%${centro}%`); }
        if (proveedor) { query += ` AND nombre_proveedor LIKE ?`; params.push(`%${proveedor}%`); }
        if (programa) { query += ` AND nombre_programa LIKE ?`; params.push(`%${programa}%`); }
        query += ` AND fecha_viaje >= ?`; params.push(fechaDesde);
        query += ` AND fecha_viaje <= ?`; params.push(fechaHasta);

        query += ` ORDER BY fecha_viaje DESC, hora_inicio DESC`;

        const [rows] = await db.query(query, params);
        resultados = rows;
    }

    let vehiculosPorProveedor = 0;
    if (proveedor) {
      const [res] = await db.query(`SELECT COUNT(*) as total FROM contrato WHERE nombre_proveedor LIKE ?`, [`%${proveedor}%`]);
      vehiculosPorProveedor = res[0].total;
    }
    
    res.status(200).json({
      resultados: resultados,
      esSinMovimiento: Movimiento === 'SinMovmiento',
      diasInactivos: diasRangoReporte,
      resumen: {
        totalRegistros: resultados.length,
        totalCentrosVisitados: Movimiento === 'SinMovmiento' ? 0 : new Set(resultados.map(r => r.punto_destino)).size,
        vehiculosPorProveedor: vehiculosPorProveedor,
      }
    });

  } catch (error) {
    console.error('Error al generar reporte:', error);
    res.status(500).json({ message: 'Error interno del servidor.' });
  }
};

// --- Función para exportar el dashboard en PDF ---
/*exports.exportarDashboard = async (req, res) => {
  try {
    
    const [centros] = await db.query(`
      SELECT destino, COUNT(*) AS total_viajes FROM (
        SELECT punto_destino AS destino FROM VIAJE UNION ALL SELECT punto_destino FROM VIAJE_MASIVO
      ) AS t GROUP BY destino ORDER BY total_viajes DESC LIMIT 5;
    `);
    const [vehiculos] = await db.query(`
      SELECT v.marca, v.modelo, v.patente, COUNT(*) AS total_viajes FROM (
        SELECT vehiculo_patente FROM VIAJE WHERE vehiculo_patente IS NOT NULL UNION ALL SELECT vehiculo_patente FROM VIAJE_MASIVO WHERE vehiculo_patente IS NOT NULL
      ) AS t JOIN VEHICULO v ON t.vehiculo_patente = v.patente GROUP BY v.patente, v.marca, v.modelo ORDER BY total_viajes DESC LIMIT 5;
    `);
    const [programas] = await db.query(`
      SELECT p.nombre_programa, COUNT(*) AS total_viajes FROM (
        SELECT PROGRAMA_id_programa AS id FROM VIAJE UNION ALL SELECT PROGRAMA_id_programa FROM VIAJE_MASIVO
      ) AS t JOIN PROGRAMA p ON t.id = p.id_programa GROUP BY p.nombre_programa ORDER BY total_viajes DESC LIMIT 5;
    `);
    const [usuarios] = await db.query(`
      SELECT u.nombre, u.apellido_paterno, COUNT(*) AS total_solicitudes FROM (
        SELECT solicitante_rut_usuario AS rut FROM VIAJE UNION ALL SELECT solicitante_rut_usuario FROM VIAJE_MASIVO
      ) AS t JOIN USUARIO u ON t.rut = u.rut_usuario GROUP BY u.nombre, u.apellido_paterno ORDER BY total_solicitudes DESC LIMIT 5;
    `);

    // 2. Creamos el documento PDF
    const doc = new jsPDF();

    const imagen64 = logoBase64.split(',')[1];

    const imageBuffer = Buffer.from(imagen64, 'base64');

   // let finalY = 0; 
    
    // Logo de la empresa (base64)
    doc.addImage(imageBuffer, 'PNG', 150, 10, 40, 15);

    doc.setFontSize(18);
    doc.text("Reportes Generales", 14, 20);
    finalY = 25;


    // Tabla de Centros
    doc.setFontSize(12);
    doc.text("Centros con Mayor Uso", 14, finalY);
    autoTable(doc, {
      head: [['Centro', 'Total Viajes']],
      body: centros.map(item => [item.destino, item.total_viajes]),
      startY: finalY + 5,
    });
    finalY = doc.lastAutoTable.finalY + 15;

    doc.text("Vehículos Más Utilizados", 14, finalY);
    autoTable(doc, {
      head: [['Vehículo', 'Total Viajes']],
      body: vehiculos.map(item => [`${item.marca} ${item.modelo} (${item.patente})`, item.total_viajes]),
      startY: finalY + 5,
    });
    finalY = doc.lastAutoTable.finalY + 15;
    
    doc.text("Programas con Mayor Uso", 14, finalY);
    autoTable(doc, {
      head: [['Programa', 'Total Viajes']],
      body: programas.map(item => [item.nombre_programa, item.total_viajes]),
      startY: finalY + 5,
    });
    finalY = doc.lastAutoTable.finalY + 15;

    doc.text("Usuarios con Más Solicitudes", 14, finalY);
     autoTable(doc, {
      head: [['Usuario', 'Total Solicitudes']],
      body: usuarios.map(item => [`${item.nombre} ${item.apellido_paterno}`, item.total_solicitudes]),
      startY: finalY + 5,
    });

    res.setHeader('Content-Type', 'application/pdf');
    res.setHeader('Content-Disposition', 'attachment; filename=reporte_dashboard.pdf');
    res.send(Buffer.from(doc.output('arraybuffer')));

  } catch (error) {
    console.error('Error al exportar el dashboard:', error);
    res.status(500).json({ message: 'Error interno del servidor.' });
  }
};*/

exports.exportarDashboard = async (req, res) => {
  try {
    const [centros] = await db.query(`
      SELECT destino, COUNT(*) AS total_viajes FROM (
        SELECT punto_destino AS destino FROM viaje UNION ALL SELECT punto_destino FROM viaje_masivo
      ) AS t GROUP BY destino ORDER BY total_viajes DESC LIMIT 5;
    `);
    const [vehiculos] = await db.query(`
      SELECT v.marca, v.modelo, v.patente, COUNT(*) AS total_viajes FROM (
        SELECT vehiculo_patente FROM viaje WHERE vehiculo_patente IS NOT NULL UNION ALL SELECT vehiculo_patente FROM viaje_masivo WHERE vehiculo_patente IS NOT NULL
      ) AS t JOIN vehiculo v ON t.vehiculo_patente = v.patente GROUP BY v.patente, v.marca, v.modelo ORDER BY total_viajes DESC LIMIT 5;
    `);
    const [programas] = await db.query(`
      SELECT p.nombre_programa, COUNT(*) AS total_viajes FROM (
        SELECT programa_id_programa AS id FROM viaje UNION ALL SELECT programa_id_programa FROM viaje_masivo
      ) AS t JOIN programa p ON t.id = p.id_programa GROUP BY p.nombre_programa ORDER BY total_viajes DESC LIMIT 5;
    `);
    const [usuarios] = await db.query(`
      SELECT u.nombre, u.apellido_paterno, COUNT(*) AS total_solicitudes FROM (
        SELECT solicitante_rut_usuario AS rut FROM viaje UNION ALL SELECT solicitante_rut_usuario FROM viaje_masivo
      ) AS t JOIN usuario u ON t.rut = u.rut_usuario GROUP BY u.nombre, u.apellido_paterno ORDER BY total_solicitudes DESC LIMIT 5;
    `);

    const doc = new jsPDF();
    // Asegúrate de definir logoBase64 al inicio del archivo
    if(logoBase64) {
        const imagen64 = logoBase64.split(',')[1];
        const imageBuffer = Buffer.from(imagen64, 'base64');
        doc.addImage(imageBuffer, 'PNG', 150, 10, 40, 15);
    }
    
    doc.setFontSize(18);
    doc.text("Reportes Generales", 14, 20);
    
    let finalY = 25;

    // Tabla de Centros
    doc.setFontSize(12);
    doc.text("Centros con Mayor Uso", 14, finalY);
    autoTable(doc, {
      head: [['Centro', 'Total Viajes']],
      body: centros.map(item => [item.destino, item.total_viajes]),
      startY: finalY + 5,
    });
    finalY = doc.lastAutoTable.finalY + 15;

    doc.text("Vehículos Más Utilizados", 14, finalY);
    autoTable(doc, {
      head: [['Vehículo', 'Total Viajes']],
      body: vehiculos.map(item => [`${item.marca} ${item.modelo} (${item.patente})`, item.total_viajes]),
      startY: finalY + 5,
    });
    finalY = doc.lastAutoTable.finalY + 15;
    
    doc.text("Programas con Mayor Uso", 14, finalY);
    autoTable(doc, {
      head: [['Programa', 'Total Viajes']],
      body: programas.map(item => [item.nombre_programa, item.total_viajes]),
      startY: finalY + 5,
    });
    finalY = doc.lastAutoTable.finalY + 15;

    doc.text("Usuarios con Más Solicitudes", 14, finalY);
     autoTable(doc, {
      head: [['Usuario', 'Total Solicitudes']],
      body: usuarios.map(item => [`${item.nombre} ${item.apellido_paterno}`, item.total_solicitudes]),
      startY: finalY + 5,
    });

    res.setHeader('Content-Type', 'application/pdf');
    res.setHeader('Content-Disposition', 'attachment; filename=reporte_dashboard.pdf');
    res.send(Buffer.from(doc.output('arraybuffer')));

  } catch (error) {
    console.error('Error al exportar el dashboard:', error);
    res.status(500).json({ message: 'Error interno del servidor.' });
  }
};